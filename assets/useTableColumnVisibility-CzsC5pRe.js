import{_ as J,y as w,e as m,c as S,o as V,f as a,h as c,m as r,k as E,n as N,L as T,M as F,A as L,s as B,t as D,r as A}from"./index-BXRoTRPN.js";const z=l=>(B("data-v-7c69e94c"),l=l(),D(),l),j={class:"column-settings"},q={class:"column-settings-content"},G={class:"settings-header"},M=z(()=>r("span",{class:"title"},"字段设置",-1)),R={class:"actions"},U={class:"columns-list"},Y={class:"column-label"},H={__name:"index",props:{columnVisibility:{type:Object,required:!0}},setup(l){const v=l,{allColumns:u,visibleColumns:i,showAllColumns:f,hideAllColumns:x,resetToDefault:I,setColumnVisibility:o}=v.columnVisibility,b=w({get:()=>Array.from(i.value),set:d=>{}}),h=(d,n)=>{o(d,n)};return(d,n)=>{const y=m("el-button"),g=m("el-divider"),C=m("el-checkbox"),k=m("el-checkbox-group"),e=m("el-popover");return V(),S("div",j,[a(e,{placement:"bottom-start",width:200,trigger:"click","popper-class":"column-settings-popover","show-arrow":!1,"open-delay":0,"close-delay":0},{reference:c(()=>[a(y,{type:"primary",plain:"",icon:"Setting",title:"字段设置"},{default:c(()=>[N(" 字段设置 ")]),_:1})]),default:c(()=>[r("div",q,[r("div",G,[M,r("div",R,[a(y,{type:"text",size:"small",onClick:E(f)},{default:c(()=>[N(" 全选 ")]),_:1},8,["onClick"])])]),a(g,{style:{margin:"6px 0"}}),r("div",U,[a(k,{modelValue:b.value,"onUpdate:modelValue":n[0]||(n[0]=t=>b.value=t)},{default:c(()=>[(V(!0),S(T,null,F(E(u),t=>(V(),S("div",{key:t.key,class:"column-item"},[a(C,{label:t.key,disabled:t.key==="operation",onChange:s=>h(t.key,s)},{default:c(()=>[r("span",Y,L(t.label),1)]),_:2},1032,["label","disabled","onChange"])]))),128))]),_:1},8,["modelValue"])])])]),_:1})])}}},P=J(H,[["__scopeId","data-v-7c69e94c"]]),p="table-column-visibility";function Q(l,v=[]){const u=A(new Set),i=A([]),f=()=>{try{const e=localStorage.getItem(p);if(e)return JSON.parse(e)[l]||[]}catch(e){console.warn("Failed to parse stored column visibility:",e)}return[]},x=e=>{try{const t=localStorage.getItem(p),s=t?JSON.parse(t):{};s[l]=e,localStorage.setItem(p,JSON.stringify(s))}catch(t){console.warn("Failed to save column visibility:",t)}},I=e=>{i.value=e.map(s=>({...s,key:s.prop||s.property||s.label,label:s.label,visible:!0}));const t=f();t.length>0?i.value.forEach(s=>{const _=t.find(O=>O.key===s.key);_&&(s.visible=_.visible)}):i.value.forEach(s=>{s.visible=v.includes(s.key)||!0}),o()},o=()=>{u.value=new Set(i.value.filter(e=>e.visible).map(e=>e.key)),x(i.value)},b=e=>{const t=i.value.find(s=>s.key===e);t&&(t.visible=!t.visible,o())},h=(e,t)=>{const s=i.value.find(_=>_.key===e);s&&(s.visible=t,o())},d=()=>{i.value.forEach(e=>{e.visible=!0}),o()},n=()=>{i.value.forEach(e=>{e.key!=="operation"&&(e.visible=!1)}),o()},y=()=>{i.value.forEach(e=>{e.visible=v.includes(e.key)||!0}),o()},g=()=>{try{const e=localStorage.getItem(p);if(e){const t=JSON.parse(e);delete t[l],localStorage.setItem(p,JSON.stringify(t))}}catch(e){console.warn("Failed to clear stored column visibility:",e)}},C=w(()=>i.value.filter(e=>e.visible)),k=w(()=>i.value.filter(e=>!e.visible));return{visibleColumns:u,allColumns:i,visibleColumnsList:C,hiddenColumnsList:k,initializeColumns:I,toggleColumnVisibility:b,setColumnVisibility:h,showAllColumns:d,hideAllColumns:n,resetToDefault:y,clearStoredVisibility:g,isColumnVisible:e=>u.value.has(e)}}export{P as C,Q as u};
