import{P as te,_ as J,a as se,d as le,r as g,C as me,I as ve,w as Q,Z as ae,e as I,J as ne,c as r,o as c,f as s,K as oe,h as o,k as a,l as re,n as m,A as n,m as t,L as O,M as H,R as W,s as ce,t as ue,y as pe,$ as ye,Q as _e,a0 as Z,j as ee,p as $e,B as ge,D as Ie}from"./index-BXRoTRPN.js";function be(y){return te({url:"/agent/team/rebates",method:"post",data:y,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function xe(y){return te({url:"/agent/team/detail",method:"post",data:y,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function Le(y){return te({url:"/agent/team/invite",method:"post",data:y,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}const F=y=>(ce("data-v-805b4154"),y=y(),ue(),y),ke=F(()=>t("br",null,null,-1)),we={class:"wrapper"},Ce={class:"item"},Me=F(()=>t("div",{class:"title"}," L5-皇冠 ",-1)),Oe={class:"agents"},Se={class:"nickName"},Ne={class:"item"},Ee=F(()=>t("div",{class:"title"}," L4-钻石 ",-1)),Ve={class:"agents"},Ye={class:"nickName"},De={class:"item"},Re=F(()=>t("div",{class:"title"}," L3-金牌 ",-1)),qe={class:"agents"},Xe={class:"nickName"},He={class:"item"},Pe=F(()=>t("div",{class:"title"}," L2-银牌 ",-1)),Ue={class:"agents"},We={class:"nickName"},Ae={class:"item",style:{"border-bottom":"none"}},Be=F(()=>t("div",{class:"title"}," L1-普通会员 ",-1)),Te={class:"agents"},Ke={class:"nickName"},ze={__name:"teamRebates",props:["id"],emits:["update:userId"],setup(y,{emit:P}){se();const{proxy:S}=le(),C=g(!1),l=g([]),i=y,b=P,N=me({queryParams:{userId:i.id}}),{queryParams:p}=ve(N);Q(()=>i.id,f=>{f!==p.value.userId&&(p.value.userId=f)},{immediate:!0}),ae(()=>{i.id&&E()});function E(){if(!p.value.userId)return S.$modal.msgError("请输入用户ID"),!1;C.value=!0,be({userId:p.value.userId}).then(f=>{C.value=!1,l.value=f.data})}return Q(()=>p.value.userId,f=>{b("update:userId",f)}),(f,x)=>{const D=I("el-input"),h=I("el-form-item"),A=I("el-button"),B=I("el-form"),u=I("el-col"),$=I("el-row"),v=ne("loading");return c(),r(O,null,[s($,{gutter:20},{default:o(()=>[s(u,{xs:24},{default:o(()=>[s(B,{model:a(p),ref:"queryRef",inline:!0,"label-width":"68px"},{default:o(()=>[s(h,{label:"会员查询",prop:"userId"},{default:o(()=>[s(D,{oninput:"if(value.length>6)value=value.slice(0,6)",modelValue:a(p).userId,"onUpdate:modelValue":x[0]||(x[0]=e=>a(p).userId=e),modelModifiers:{number:!0},type:"number",placeholder:"请输入会员id",clearable:"",style:{width:"150px"},onKeyup:re(E,["enter"])},null,8,["modelValue"])]),_:1}),s(h,null,{default:o(()=>[s(A,{type:"primary",icon:"Search",onClick:E},{default:o(()=>[m("查询")]),_:1})]),_:1}),ke,s(h,null,{default:o(()=>[m(" 总返佣人数："+n(a(l).total||0),1)]),_:1}),s(h,null,{default:o(()=>[m(" L4-钻石会员人数："+n(a(l).totalOfL4||0),1)]),_:1}),s(h,null,{default:o(()=>[m(" L3-金牌会员人数："+n(a(l).totalOfL3||0),1)]),_:1}),s(h,null,{default:o(()=>[m(" L2-银牌会员人数："+n(a(l).totalOfL2||0),1)]),_:1}),s(h,null,{default:o(()=>[m(" L1-普通会员人数："+n(a(l).totalOfL1||0),1)]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),oe((c(),r("div",we,[t("div",Ce,[Me,t("div",Oe,[(c(!0),r(O,null,H(a(l).membersOfL5,(e,d)=>(c(),r("div",{class:W(["box",e.userId==a(l).userId?"active":""]),key:d},[t("div",Se,n(e.nickname),1),m(" ("+n(e.userId)+") ",1)],2))),128))])]),t("div",Ne,[Ee,t("div",Ve,[(c(!0),r(O,null,H(a(l).membersOfL4,(e,d)=>(c(),r("div",{class:W(["box",e.userId==a(l).userId?"active":""]),key:d},[t("div",Ye,n(e.nickname),1),m(" ("+n(e.userId)+") ",1)],2))),128))])]),t("div",De,[Re,t("div",qe,[(c(!0),r(O,null,H(a(l).membersOfL3,(e,d)=>(c(),r("div",{class:W(["box",e.userId==a(l).userId?"active":""]),key:d},[t("div",Xe,n(e.nickname),1),m(" ("+n(e.userId)+") ",1)],2))),128))])]),t("div",He,[Pe,t("div",Ue,[(c(!0),r(O,null,H(a(l).membersOfL2,(e,d)=>(c(),r("div",{class:W(["box",e.userId==a(l).userId?"active":""]),key:d},[t("div",We,n(e.nickname),1),m(" ("+n(e.userId)+") ",1)],2))),128))])]),t("div",Ae,[Be,t("div",Te,[(c(!0),r(O,null,H(a(l).membersOfL1,(e,d)=>(c(),r("div",{class:W(["box",e.userId==a(l).userId?"active":""]),key:d},[t("div",Ke,n(e.nickname),1),m(" ("+n(e.userId)+") ",1)],2))),128))])])])),[[v,a(C)]])],64)}}},Qe=J(ze,[["__scopeId","data-v-805b4154"]]),je={class:"tree-chart-container"},Fe={class:"level-headers"},Ge={class:"level-title"},Je={key:0,class:"level-divider"},Ze=["width","height"],et=["d"],tt={class:"tree-nodes"},st=["onClick"],lt={class:"node-name"},at={class:"node-id"},nt={class:"node-level"},ot={__name:"agentChart",props:{treeData:{type:Array,default:()=>[]}},setup(y){const P=y,S=g(P.treeData||[]),C=g([]),l=g(1200),i=g(800),b=g(null),N=g(0),p=g(new Map),E=pe(()=>{const u=[],$=(v,e=0)=>{v.forEach(d=>{u.push({...d,_level:e}),d.memberList&&d.memberList.length>0&&$(d.memberList,e+1)})};return $(S.value),u}),f=()=>{const u=new Map,$=120,v=200,e=new Map,d=(k,w=0)=>{let M=0;return k.forEach(T=>{if(T.memberList&&T.memberList.length>0){const z=d(T.memberList,w+1);M=Math.max(M,z)}else M=Math.max(M,$)}),e.set(w,M),M};d(S.value);const j=new Map,_=Math.max(...Array.from(e.values()));e.forEach((k,w)=>{const M=(_-k)/2;j.set(w,M),console.log(`层级${w}高度: ${k}, 起始Y: ${M}, 容器高度: ${_}`)});const V=(k,w=0,M=0)=>{let T=M;return k.forEach((z,fe)=>{const ie=w*v+100,de=j.get(w)+T+$/2+70;if(u.set(z.userId,{x:ie,y:de,level:w,index:fe}),console.log(`节点${z.nickname}位置: level=${w}, x=${ie}, y=${de}, 层级起始Y=${j.get(w)}`),z.memberList&&z.memberList.length>0){const he=T;z.memberList.length*$,T=V(z.memberList,w+1,he)}else T+=$}),T};V(S.value),p.value=u;const Y=Math.max(...Array.from(u.values()).map(k=>k.level)),L=Math.max(...Array.from(u.values()).map(k=>k.y)),R=Math.min(...Array.from(u.values()).map(k=>k.y)),q=(Y+1)*v,U=L-R+300;l.value=Math.max(q,1200),i.value=Math.max(U,0),N.value=Y;const X=document.querySelector(".tree-chart-container");if(X){const k=i.value;X.style.height=`${k}px`,console.log(`设置容器高度为: ${k}px`)}b.value&&(b.value.style.height=`${i.value}px`,console.log(`设置tree-wrapper高度为: ${i.value}px`));const K=document.querySelector(".level-headers");return K&&(K.style.width=`${l.value}px`,K.style.height=`${i.value}px`,console.log(`设置层级容器尺寸为: ${l.value}x${i.value}`)),console.log(`SVG尺寸: ${l.value}x${i.value}, 最大层级: ${Y}`),console.log(`实际数据范围: Y从${R}到${L}, 高度差: ${L-R}`),console.log(`计算的实际高度: ${U}`),u},x=()=>{const u=[],$=p.value,v=140,e=20,d=j=>{j.forEach(_=>{if(_.memberList&&_.memberList.length>0){const V=$.get(_.userId);_.memberList.forEach(Y=>{const L=$.get(Y.userId);if(V&&L){const R=V.x+v/2,q=V.y,U=L.x-v/2,X=L.y,K=R+e,k=U-e;let w="";if(Math.abs(q-X)<20)w=`M ${R} ${q} L ${U} ${X}`;else{const M=(K+k)/2;w=`M ${R} ${q}
                      L ${K} ${q}
                      L ${M} ${q}
                      L ${M} ${X}
                      L ${k} ${X}
                      L ${U} ${X}`}u.push({path:w,parent:_,child:Y}),console.log(`连接线: ${_.nickname} -> ${Y.nickname}`),console.log(`父节点中心位置: (${V.x}, ${V.y})`),console.log(`子节点中心位置: (${L.x}, ${L.y})`),console.log(`父节点右侧连接点: (${R}, ${q})`),console.log(`子节点左侧连接点: (${U}, ${X})`),console.log(`路径: ${w}`)}}),d(_.memberList)}})};d(S.value),C.value=u},D=u=>{const $=p.value.get(u.userId);return $?{position:"absolute",left:`${$.x-90}px`,top:`${$.y-20}px`,transform:"translateY(-50%)"}:{}},h=u=>({position:"absolute",left:`${u*200}px`,top:"0",width:"200px",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",zIndex:1}),A=u=>u._level===0?"level-gold":"level-normal",B=u=>{console.log("点击节点:",u)};return ye(()=>{_e(()=>{f(),x()})}),Q([S,()=>P.treeData],()=>{_e(()=>{f(),x();const u=document.querySelector(".tree-chart-container");u&&(u.style.height=`${i.value}px`),b.value&&(b.value.style.height=`${i.value}px`);const $=document.querySelector(".level-headers");$&&($.style.width=`${l.value}px`,$.style.height=`${i.value}px`)})},{deep:!0}),Q(()=>P.treeData,u=>{u&&u.length>0&&(S.value=u)},{deep:!0}),(u,$)=>(c(),r("div",je,[t("div",{class:"tree-wrapper",ref_key:"treeContainer",ref:b},[t("div",Fe,[(c(!0),r(O,null,H(N.value+1,v=>(c(),r("div",{key:`level-${v-1}`,class:"level-header",style:Z(h(v-1))},[t("div",Ge,"层级"+n(v+S.value[0].agentLevel-1),1),v-1<N.value?(c(),r("div",Je)):ee("",!0)],4))),128))]),(c(),r("svg",{width:l.value,height:i.value,class:"tree-svg",style:{overflow:"visible"}},[(c(!0),r(O,null,H(C.value,(v,e)=>(c(),r("g",{key:`connection-${e}`},[t("path",{d:v.path,stroke:"#409EFF","stroke-width":"2",fill:"none",opacity:"0.8"},null,8,et)]))),128))],8,Ze)),t("div",tt,[(c(!0),r(O,null,H(E.value,v=>(c(),r("div",{key:v.userId,class:"tree-node",style:Z(D(v)),onClick:e=>B(v)},[t("div",{class:W(["node-content",A(v)])},[t("div",lt,n(v.nickname),1),t("div",at,"("+n(v.userId)+")",1),t("div",nt," L"+n(v.levelVal)+"-"+n(v.levelName),1)],2)],12,st))),128))])],512)]))}},rt=J(ot,[["__scopeId","data-v-354cec8b"]]),ct=y=>(ce("data-v-9a0a5105"),y=y(),ue(),y),ut=ct(()=>t("br",null,null,-1)),it={key:0,class:"controls"},dt={key:1,class:"wrapper"},_t={__name:"teamDetail",props:["id"],emits:["update:userId"],setup(y,{emit:P}){const{proxy:S}=le(),C=y,l=P,i=g({userId:C.id}),b=g([]),N=g([]),p=g(!1);let E=g(12);const f=g(1),x=g({x:0,y:0}),D=g(!1),h=g({x:0,y:0}),A=g(null),B=pe(()=>({transform:`translate(${x.value.x}px, ${x.value.y}px) scale(${f.value})`,transformOrigin:"0 0",cursor:D.value?"grabbing":"grab",transition:D.value?"none":"transform 0.1s",display:"inline-block"}));Q(()=>C.id,_=>{_!==i.value.userId&&(i.value.userId=_)},{immediate:!0}),ae(()=>{C.id&&u()});function u(){if(!i.value.userId)return S.$modal.msgError("请输入用户ID"),!1;p.value=!0,E=i.value.userId,console.log(E),xe({userId:i.value.userId}).then(_=>{p.value=!1,b.value=_.data,N.value[0]=_.data.members}).catch(_=>{p.value=!1})}function $(_){_.preventDefault();const V=_.deltaY>0?.9:1.1,Y=Math.max(.2,Math.min(2,f.value*V)),L=A.value.getBoundingClientRect(),R=_.clientX-L.left,q=_.clientY-L.top,U=R-x.value.x,X=q-x.value.y;x.value.x=R-U*(Y/f.value),x.value.y=q-X*(Y/f.value),f.value=Y}function v(_){D.value=!0,h.value={x:_.clientX,y:_.clientY},document.addEventListener("mousemove",e),document.addEventListener("mouseup",d)}function e(_){if(!D.value)return;const V=_.clientX-h.value.x,Y=_.clientY-h.value.y;x.value.x+=V,x.value.y+=Y,h.value={x:_.clientX,y:_.clientY}}function d(){D.value=!1,document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",d)}function j(){f.value=1,x.value={x:0,y:0}}return Q(()=>i.value.userId,_=>{l("update:userId",_)}),(_,V)=>{const Y=I("el-input"),L=I("el-form-item"),R=I("el-button"),q=I("el-form"),U=I("el-col"),X=I("el-row"),K=I("Refresh"),k=I("el-icon"),w=ne("loading");return c(),r(O,null,[s(X,{gutter:20},{default:o(()=>[s(U,{xs:24},{default:o(()=>[s(q,{model:i.value,inline:!0,"label-width":"68px"},{default:o(()=>[s(L,{label:"会员查询",prop:"userId"},{default:o(()=>[s(Y,{oninput:"if(value.length>6)value=value.slice(0,6)",modelValue:i.value.userId,"onUpdate:modelValue":V[0]||(V[0]=M=>i.value.userId=M),type:"number",placeholder:"请输入会员id",clearable:"",style:{width:"150px"},onKeyup:re(u,["enter"])},null,8,["modelValue"])]),_:1}),s(L,null,{default:o(()=>[s(R,{type:"primary",icon:"Search",onClick:u},{default:o(()=>[m("查询")]),_:1})]),_:1}),ut,s(L,null,{default:o(()=>[m(" 团队总人数："+n(b.value.total||0),1)]),_:1}),s(L,null,{default:o(()=>[m(" L5-皇冠会员人数："+n(b.value.totalOfL5||0),1)]),_:1}),s(L,null,{default:o(()=>[m(" L4-钻石会员人数："+n(b.value.totalOfL4||0),1)]),_:1}),s(L,null,{default:o(()=>[m(" L3-金牌会员人数："+n(b.value.totalOfL3||0),1)]),_:1}),s(L,null,{default:o(()=>[m(" L2-银牌会员人数："+n(b.value.totalOfL2||0),1)]),_:1}),s(L,null,{default:o(()=>[m(" L1-普通会员人数："+n(b.value.totalOfL1||0),1)]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),N.value.length>0?(c(),r("div",it,[s(R,{type:"primary",onClick:j},{default:o(()=>[s(k,null,{default:o(()=>[s(K)]),_:1}),m(" 重置视图 ")]),_:1})])):ee("",!0),N.value.length>0?oe((c(),r("div",dt,[t("div",{class:"tree-zoom-pan-container",ref_key:"treeContainer",ref:A,style:Z(B.value),onMousedown:v,onWheel:$e($,["prevent"])},[s(rt,{treeData:N.value},null,8,["treeData"])],36)])),[[w,p.value]]):ee("",!0)],64)}}},mt=J(_t,[["__scopeId","data-v-9a0a5105"]]),G=y=>(ce("data-v-b06af348"),y=y(),ue(),y),vt=G(()=>t("br",null,null,-1)),pt={class:"wrapper"},ft={class:"item"},ht=G(()=>t("div",{class:"title"}," L5-皇冠 ",-1)),yt={class:"agents"},$t={class:"nickName"},gt={class:"item"},It=G(()=>t("div",{class:"title"}," L4-钻石 ",-1)),bt={class:"agents"},xt={class:"nickName"},Lt={class:"item"},kt=G(()=>t("div",{class:"title"}," L3-金牌 ",-1)),wt={class:"agents"},Ct={class:"nickName"},Mt={class:"item"},Ot=G(()=>t("div",{class:"title"}," L2-银牌 ",-1)),St={class:"agents"},Nt={class:"nickName"},Et={class:"item",style:{"border-bottom":"none"}},Vt=G(()=>t("div",{class:"title"}," L1-普通会员 ",-1)),Yt={class:"agents"},Dt={class:"nickName"},Rt={__name:"teamInvite",props:["id"],emits:["update:userId"],setup(y,{emit:P}){se();const{proxy:S}=le(),C=g(!1),l=g([]),i=y,b=P,N=me({queryParams:{userId:i.id}}),{queryParams:p}=ve(N);Q(()=>i.id,f=>{f!==p.value.userId&&(p.value.userId=f)},{immediate:!0}),ae(()=>{i.id&&E()});function E(){if(!p.value.userId)return S.$modal.msgError("请输入用户ID"),!1;C.value=!0,Le({userId:p.value.userId}).then(f=>{C.value=!1,l.value=f.data})}return Q(()=>p.value.userId,f=>{b("update:userId",f)}),(f,x)=>{const D=I("el-input"),h=I("el-form-item"),A=I("el-button"),B=I("el-form"),u=I("el-col"),$=I("el-row"),v=ne("loading");return c(),r(O,null,[s($,{gutter:20},{default:o(()=>[s(u,{xs:24},{default:o(()=>[s(B,{model:a(p),ref:"queryRef",inline:!0,"label-width":"68px"},{default:o(()=>[s(h,{label:"会员查询",prop:"userId"},{default:o(()=>[s(D,{modelValue:a(p).userId,"onUpdate:modelValue":x[0]||(x[0]=e=>a(p).userId=e),type:"number",placeholder:"请输入会员id",clearable:"",style:{width:"150px"},onKeyup:re(E,["enter"])},null,8,["modelValue"])]),_:1}),s(h,null,{default:o(()=>[s(A,{type:"primary",icon:"Search",onClick:E},{default:o(()=>[m("查询")]),_:1})]),_:1}),vt,s(h,null,{default:o(()=>[m(" 总邀请人数："+n(a(l).total||0),1)]),_:1}),s(h,null,{default:o(()=>[m(" L5-皇冠会员人数："+n(a(l).totalOfL5||0),1)]),_:1}),s(h,null,{default:o(()=>[m(" L4-钻石会员人数："+n(a(l).totalOfL4||0),1)]),_:1}),s(h,null,{default:o(()=>[m(" L3-金牌会员人数："+n(a(l).totalOfL3||0),1)]),_:1}),s(h,null,{default:o(()=>[m(" L2-银牌会员人数："+n(a(l).totalOfL2||0),1)]),_:1}),s(h,null,{default:o(()=>[m(" L1-普通会员人数："+n(a(l).totalOfL1||0),1)]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),oe((c(),r("div",pt,[t("div",ft,[ht,t("div",yt,[(c(!0),r(O,null,H(a(l).membersOfL5,(e,d)=>(c(),r("div",{class:W(["box",e.userId==a(l).userId?"active":""]),key:d},[t("div",$t,n(e.nickname),1),m(" ("+n(e.userId)+") ",1)],2))),128))])]),t("div",gt,[It,t("div",bt,[(c(!0),r(O,null,H(a(l).membersOfL4,(e,d)=>(c(),r("div",{class:W(["box",e.userId==a(l).userId?"active":""]),key:d},[t("div",xt,n(e.nickname),1),m(" ("+n(e.userId)+") ",1)],2))),128))])]),t("div",Lt,[kt,t("div",wt,[(c(!0),r(O,null,H(a(l).membersOfL3,(e,d)=>(c(),r("div",{class:W(["box",e.userId==a(l).userId?"active":""]),key:d},[t("div",Ct,n(e.nickname),1),m(" ("+n(e.userId)+") ",1)],2))),128))])]),t("div",Mt,[Ot,t("div",St,[(c(!0),r(O,null,H(a(l).membersOfL2,(e,d)=>(c(),r("div",{class:W(["box",e.userId==a(l).userId?"active":""]),key:d},[t("div",Nt,n(e.nickname),1),m(" ("+n(e.userId)+") ",1)],2))),128))])]),t("div",Et,[Vt,t("div",Yt,[(c(!0),r(O,null,H(a(l).membersOfL1,(e,d)=>(c(),r("div",{class:W(["box",e.userId==a(l).userId?"active":""]),key:d},[t("div",Dt,n(e.nickname),1),m(" ("+n(e.userId)+") ",1)],2))),128))])])])),[[v,a(C)]])],64)}}},qt=J(Rt,[["__scopeId","data-v-b06af348"]]),Xt={class:"app-container"},Ht=ge({name:"User"}),Ut=Object.assign(Ht,{setup(y){var N,p,E,f;const P=se();let S="type"+(((p=(N=P.currentRoute.value)==null?void 0:N.query)==null?void 0:p.type)||1),C=((f=(E=P.currentRoute.value)==null?void 0:E.query)==null?void 0:f.id)||void 0;const l=g(S),i=g(C),b=x=>{i.value=x};return(x,D)=>{const h=I("el-tab-pane"),A=I("el-tabs");return c(),r("div",Xt,[s(A,{type:"border-card",modelValue:a(l),"onUpdate:modelValue":D[0]||(D[0]=B=>Ie(l)?l.value=B:null)},{default:o(()=>[s(h,{label:"返佣人数查询",name:"type1"},{default:o(()=>[s(Qe,{id:a(i),"onUpdate:userId":b},null,8,["id"])]),_:1}),s(h,{label:"团队成员查询",name:"type2"},{default:o(()=>[s(mt,{id:a(i),"onUpdate:userId":b},null,8,["id"])]),_:1}),s(h,{label:"邀请人数查询",name:"type3"},{default:o(()=>[s(qt,{id:a(i),"onUpdate:userId":b},null,8,["id"])]),_:1})]),_:1},8,["modelValue"])])}}});export{Ut as default};
